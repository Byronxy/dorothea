<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TF activity inference from scRNA-seq data with DoRothEA as regulon resource. • dorothea</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="TF activity inference from scRNA-seq data with DoRothEA as regulon resource.">
<meta property="og:description" content="dorothea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dorothea</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bulk_vignette.html">TF activity inference from bulk transcriptomic data with DoRothEA as regulon resource.</a>
    </li>
    <li>
      <a href="../articles/single_cell_vignette.html">TF activity inference from scRNA-seq data with DoRothEA as regulon resource.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/saezlab/dorothea/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>TF activity inference from scRNA-seq data with DoRothEA as regulon resource.</h1>
                        <h4 class="author">Christian H. Holland</h4>
            <address class="author_afil">
      Institute for Computational Biomedicine, Heidelberg University<br><a class="author_email" href="mailto:#"></a><a href="mailto:christian.holland@bioquant.uni-heidelberg.de" class="email">christian.holland@bioquant.uni-heidelberg.de</a>
      </address>
                              <h4 class="author">Alberto Valdeolivas</h4>
            <address class="author_afil">
      Institute for Computational Biomedicine, Heidelberg University<br><a class="author_email" href="mailto:#"></a><a href="mailto:alberto.valdeolivas@bioquant.uni-heidelberg.de" class="email">alberto.valdeolivas@bioquant.uni-heidelberg.de</a>
      </address>
                              <h4 class="author">Julio Saez-Rodriguez</h4>
            <address class="author_afil">
      Institute for Computational Biomedicine, Heidelberg University<br><small class="dont-index">Source: <a href="https://github.com/saezlab/dorothea/blob/master/vignettes/single_cell_vignette.Rmd"><code>vignettes/single_cell_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>single_cell_vignette.Rmd</code></div>

    </address>
</div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      This vignette describes how to infer transcription factor activity from scRNA-seq data by running Viper on DoRothEA’s curated regulons.
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><strong>DoRothEA</strong> is a comprehensive resource containing a curated collection of transcription factors (TFs) and its transcriptional targets. The set of genes regulated by a specific transcription factor is known as regulon. DoRothEA’s regulons were gathered from different types of evidence. Each TF-target interaction is defined by a confidence level based on the number of supporting evidence. The confidence levels ranges from A (highest confidence) to E (lowest confidence) <span class="citation">(Garcia-Alonso et al. 2019)</span>.</p>
<p><strong>DoRothEA</strong> regulons are usually coupled with the statistical method <strong>VIPER</strong> <span class="citation">(Alvarez et al. 2016)</span>. In this context, TF activities are computed based on the mRNA expression levels of its targets. We therefore can consider TF activity as a proxy of a given transcriptional state <span class="citation">(Dugourd and Saez-Rodriguez 2019)</span>.</p>
<p><span class="citation">Holland et al. (2020)</span> evaluated the performance of <strong>DoRothEA</strong> in combination with <strong>VIPER</strong> when applied to scRNA-seq data. We showed that, in spite of the current limitations of scRNA-seq technologies, their approach can provide meaningful results in this context. Indeed, this vignette shows an example on how to apply <strong>DoRothEA</strong> regulons coupled with <strong>VIPER</strong> in a well known single-cell dataset.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>First of all, you need a current version of R (<a href="http://www.r-project.org" class="uri">http://www.r-project.org</a>). <em><a href="https://bioconductor.org/packages/3.11/DoRothEA">DoRothEA</a></em> is a freely available annotation package deposited on <a href="http://bioconductor.org/" class="uri">http://bioconductor.org/</a> and <a href="https://github.com/saezlab/dorothea" class="uri">https://github.com/saezlab/dorothea</a>.</p>
<p>You can install it by running the following commands on an R console:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"BiocManager"</span>, <span class="kw">quietly</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"BiocManager"</span>)

<span class="kw pkg">BiocManager</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span>(<span class="st">"dorothea"</span>)</pre></body></html></div>
<p>We also load here the packages required to run this script.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co">## We load the required packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dorothea</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Seurat</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pheatmap</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viper</span>)</pre></body></html></div>
</div>
<div id="example-of-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#example-of-usage" class="anchor"></a>Example of usage</h1>
<p>In the following paragraphs, we provide examples describing how to run <strong>VIPER</strong> on <strong>DoRothEA</strong> regulons in a scRNA-seq dataset. In particular, we use the <em><a href="https://CRAN.R-project.org/package=Seurat">Seurat</a></em> toolkit for single cell genomics <span class="citation">(Stuart et al. 2019)</span>. For the sake of simplicity, we follow the example provided in the following <em><a href="https://CRAN.R-project.org/package=Seurat">Seurat</a></em> vignette:</p>
<p><a href="https://satijalab.org/seurat/v3.1/pbmc3k_tutorial.html" class="uri">https://satijalab.org/seurat/v3.1/pbmc3k_tutorial.html</a></p>
<p>The dataset contains 2700 Peripheral Blood Mononuclear Cells (PBMC) that were sequenced on the Illumina NextSeq 500. This dataset is freely available in 10X Genomics:</p>
<p><a href="https://s3-us-west-2.amazonaws.com/10x.files/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz" class="uri">https://s3-us-west-2.amazonaws.com/10x.files/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz</a></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## Load the PBMC dataset</span>
<span class="no">pbmc.data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/Read10X.html">Read10X</a></span>(<span class="kw">data.dir</span> <span class="kw">=</span> <span class="st">"filtered_gene_bc_matrices/hg19/"</span>)

<span class="co">## Initialize the Seurat object with the raw (non-normalized data).</span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/CreateSeuratObject.html">CreateSeuratObject</a></span>(<span class="kw">counts</span> <span class="kw">=</span> <span class="no">pbmc.data</span>, <span class="kw">project</span> <span class="kw">=</span> <span class="st">"pbmc3k"</span>,
                           <span class="kw">min.cells</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">min.features</span> <span class="kw">=</span> <span class="fl">200</span>)</pre></body></html></div>
<div id="pre-processing-normalization-and-identification-of-highly-variable-features" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-processing-normalization-and-identification-of-highly-variable-features" class="anchor"></a>Pre-processing, normalization and identification of highly variable features</h2>
<p>We follow the standard pre-processing steps as described in the aforementioned <em><a href="https://CRAN.R-project.org/package=Seurat">Seurat</a></em> vignette before going deeper into the data analysis. These steps carry out the selection and filtration of cells based on quality control metrics, the data normalization and scaling, and the detection of highly variable features (see <a href="https://satijalab.org/seurat/v3.1/pbmc3k_tutorial.html" class="uri">https://satijalab.org/seurat/v3.1/pbmc3k_tutorial.html</a>).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">## Identification of mithocondrial genes</span>
<span class="no">pbmc</span><span class="kw">[[</span><span class="st">"percent.mt"</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/PercentageFeatureSet.html">PercentageFeatureSet</a></span>(<span class="no">pbmc</span>, <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"^MT-"</span>)

<span class="co">## Filtering cells following standard QC criteria.</span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/subset.Seurat.html">subset</a></span>(<span class="no">pbmc</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="no">nFeature_RNA</span> <span class="kw">&gt;</span> <span class="fl">200</span> <span class="kw">&amp;</span> <span class="no">nFeature_RNA</span> <span class="kw">&lt;</span> <span class="fl">2500</span> <span class="kw">&amp;</span>
    <span class="no">percent.mt</span> <span class="kw">&lt;</span> <span class="fl">5</span>)

<span class="co">## Normalizing the data</span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/NormalizeData.html">NormalizeData</a></span>(<span class="no">pbmc</span>, <span class="kw">normalization.method</span> <span class="kw">=</span> <span class="st">"LogNormalize"</span>,
    <span class="kw">scale.factor</span> <span class="kw">=</span> <span class="fl">10000</span>)

<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/NormalizeData.html">NormalizeData</a></span>(<span class="no">pbmc</span>)

<span class="co">## Identify the 2000 most highly variable genes</span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindVariableFeatures.html">FindVariableFeatures</a></span>(<span class="no">pbmc</span>, <span class="kw">selection.method</span> <span class="kw">=</span> <span class="st">"vst"</span>, <span class="kw">nfeatures</span> <span class="kw">=</span> <span class="fl">2000</span>)

<span class="co">## In addition we scale the data</span>
<span class="no">all.genes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="no">pbmc</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/ScaleData.html">ScaleData</a></span>(<span class="no">pbmc</span>, <span class="kw">features</span> <span class="kw">=</span> <span class="no">all.genes</span>)</pre></body></html></div>
</div>
<div id="clustering-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-cells" class="anchor"></a>Clustering cells</h2>
<p>One of the most relevant steps in scRNA-seq data analysis is clustering. Cells are grouped based on the similarity of their transcriptomic profiles. We first apply the <em><a href="https://CRAN.R-project.org/package=Seurat">Seurat</a></em> v3 classical approach as described in their aforementioned vignette. We visualize the cell clusters using UMAP:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/RunPCA.html">RunPCA</a></span>(<span class="no">pbmc</span>, <span class="kw">features</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/VariableFeatures.html">VariableFeatures</a></span>(<span class="kw">object</span> <span class="kw">=</span> <span class="no">pbmc</span>),
               <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindNeighbors.html">FindNeighbors</a></span>(<span class="no">pbmc</span>, <span class="kw">dims</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindClusters.html">FindClusters</a></span>(<span class="no">pbmc</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/RunUMAP.html">RunUMAP</a></span>(<span class="no">pbmc</span>, <span class="kw">dims</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">umap.method</span> <span class="kw">=</span> <span class="st">"uwot"</span>, <span class="kw">metric</span> <span class="kw">=</span> <span class="st">"cosine"</span>)

<span class="no">pbmc.markers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindAllMarkers.html">FindAllMarkers</a></span>(<span class="no">pbmc</span>, <span class="kw">only.pos</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">min.pct</span> <span class="kw">=</span> <span class="fl">0.25</span>,
                               <span class="kw">logfc.threshold</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co">## Assigning cell type identity to clusters</span>
<span class="no">new.cluster.ids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Naive CD4 T"</span>, <span class="st">"Memory CD4 T"</span>, <span class="st">"CD14+ Mono"</span>, <span class="st">"B"</span>, <span class="st">"CD8 T"</span>,
                     <span class="st">"FCGR3A+ Mono"</span>, <span class="st">"NK"</span>, <span class="st">"DC"</span>, <span class="st">"Platelet"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">new.cluster.ids</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">pbmc</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/Idents.html">RenameIdents</a></span>(<span class="no">pbmc</span>, <span class="no">new.cluster.ids</span>)</pre></body></html></div>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/DimPlot.html">DimPlot</a></span>(<span class="no">pbmc</span>, <span class="kw">reduction</span> <span class="kw">=</span> <span class="st">"umap"</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">pt.size</span> <span class="kw">=</span> <span class="fl">0.5</span>) + <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/SeuratTheme.html">NoLegend</a></span>()</pre></body></html></div>
<p><img src="single_cell_vignette_files/figure-html/pca-1.png" width="700"></p>
</div>
<div id="clustering-cells-with-tf-activity" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering-cells-with-tf-activity" class="anchor"></a>Clustering cells with TF activity</h2>
<p><span class="citation">Holland et al. (2020)</span> showed that clustering the cells based on their TF activity profiles can also be very interesting. Indeed, clustering cells using TF activity computed with <strong>VIPER</strong> and <strong>DoRothEA</strong> performs better than using the expression level of the same TFs. In addition, it brings complementary information to the clusters based on transcriptomics profiles.</p>
<p>Here, we first run <strong>VIPER</strong> on <strong>DoRothEA’s</strong> regulons to obtain TFs activity, by using the wrapper function <code><a href="../reference/run_viper.html">run_viper()</a></code>. This function can deal with different input types such as matrix, dataframe, ExpressionSet or even Seurat objects. In case of a seurat object the function returns the same seurat object with an additonal assay called <code>dorothea</code> containing the TF activities in the slot <code>data</code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## We read Dorothea Regulons for Human:</span>
<span class="no">dorothea_regulon_human</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"dorothea_hs"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"dorothea"</span>))

<span class="co">## We obtain the regulons based on interactions with confidence level A, B and C</span>
<span class="no">regulon</span> <span class="kw">&lt;-</span> <span class="no">dorothea_regulon_human</span> <span class="kw">%&gt;%</span>
    <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">confidence</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>))

<span class="co">## We compute Viper Scores </span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/run_viper.html">run_viper</a></span>(<span class="no">pbmc</span>, <span class="no">regulon</span>,
                  <span class="kw">options</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">method</span> <span class="kw">=</span> <span class="st">"scale"</span>, <span class="kw">minsize</span> <span class="kw">=</span> <span class="fl">4</span>,
                                 <span class="kw">eset.filter</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">1</span>,
                                 <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>))</pre></body></html></div>
<p>We then apply <em><a href="https://CRAN.R-project.org/package=Seurat">Seurat</a></em> to cluster the cells following the same protocol than above but using TF activity scores.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## We compute the Nearest Neighbours to perform cluster</span>
<span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/DefaultAssay.html">DefaultAssay</a></span>(<span class="kw">object</span> <span class="kw">=</span> <span class="no">pbmc</span>) <span class="kw">&lt;-</span> <span class="st">"dorothea"</span>
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/ScaleData.html">ScaleData</a></span>(<span class="no">pbmc</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/RunPCA.html">RunPCA</a></span>(<span class="no">pbmc</span>, <span class="kw">features</span> <span class="kw">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="no">pbmc</span>), <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindNeighbors.html">FindNeighbors</a></span>(<span class="no">pbmc</span>, <span class="kw">dims</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindClusters.html">FindClusters</a></span>(<span class="no">pbmc</span>, <span class="kw">resolution</span> <span class="kw">=</span> <span class="fl">0.5</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/RunUMAP.html">RunUMAP</a></span>(<span class="no">pbmc</span>, <span class="kw">dims</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">10</span>, <span class="kw">umap.method</span> <span class="kw">=</span> <span class="st">"uwot"</span>, <span class="kw">metric</span> <span class="kw">=</span> <span class="st">"cosine"</span>)

<span class="no">pbmc.markers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/FindAllMarkers.html">FindAllMarkers</a></span>(<span class="no">pbmc</span>, <span class="kw">only.pos</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">min.pct</span> <span class="kw">=</span> <span class="fl">0.25</span>,
                               <span class="kw">logfc.threshold</span> <span class="kw">=</span> <span class="fl">0.25</span>, <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co">## Assigning cell type identity to clusters</span>
<span class="no">new.cluster.ids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Naive CD4 T"</span>, <span class="st">"Memory CD4 T"</span>, <span class="st">"CD14+ Mono"</span>, <span class="st">"B"</span>, <span class="st">"CD8 T"</span>,
                     <span class="st">"FCGR3A+ Mono"</span>, <span class="st">"NK"</span>, <span class="st">"DC"</span>, <span class="st">"Platelet"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">new.cluster.ids</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">pbmc</span>)
<span class="no">pbmc</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/Idents.html">RenameIdents</a></span>(<span class="no">pbmc</span>, <span class="no">new.cluster.ids</span>)</pre></body></html></div>
<pre><code>## Warning: Cannot find identity NA

## Warning: Cannot find identity NA</code></pre>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/DimPlot.html">DimPlot</a></span>(<span class="no">pbmc</span>, <span class="kw">reduction</span> <span class="kw">=</span> <span class="st">"umap"</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">pt.size</span> <span class="kw">=</span> <span class="fl">0.5</span>) + <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/SeuratTheme.html">NoLegend</a></span>()</pre></body></html></div>
<p><img src="single_cell_vignette_files/figure-html/tf%20umap-1.png" width="700"></p>
</div>
<div id="tf-activity-per-cell-population" class="section level2">
<h2 class="hasAnchor">
<a href="#tf-activity-per-cell-population" class="anchor"></a>TF activity per cell population</h2>
<p>Finally, we characterise the different cell populations based on their TF activities thanks to the previously computed <strong>VIPER</strong> scores on <strong>DoRothEA’s</strong> regulons.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co">## We transform Viper scores, scaled by seurat, into a data frame to better </span>
<span class="co">## handling the results</span>
<span class="no">viper_scores_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/GetAssayData.html">GetAssayData</a></span>(<span class="no">pbmc</span>, <span class="kw">slot</span> <span class="kw">=</span> <span class="st">"scale.data"</span>,
                                    <span class="kw">assay</span> <span class="kw">=</span> <span class="st">"dorothea"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>()

<span class="co">## We create a data frame containing the cells and their clusters</span>
<span class="no">CellsClusters</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">cell</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/Idents.html">Idents</a></span>(<span class="no">pbmc</span>)),
                            <span class="kw">cell_type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/Seurat/man/Idents.html">Idents</a></span>(<span class="no">pbmc</span>)),
                            <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co">## We create a data frame with the Viper score per cell and its clusters</span>
<span class="no">viper_scores_clusters</span> <span class="kw">&lt;-</span> <span class="no">viper_scores_df</span>  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span>(<span class="st">"cell"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">tf</span>, <span class="no">activity</span>, -<span class="no">cell</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(<span class="no">CellsClusters</span>)

<span class="co">## We summarize the Viper scores by cellpopulation</span>
<span class="no">summarized_viper_scores</span> <span class="kw">&lt;-</span> <span class="no">viper_scores_clusters</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">tf</span>, <span class="no">cell_type</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">avg</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">activity</span>),
            <span class="kw">std</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">activity</span>))</pre></body></html></div>
<p>For visualization purposes, we select the 20 most variable TFs across clusters according to our scores.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co">## We select the 20 most variable TFs. (20*9 populations = 180)</span>
<span class="no">highly_variable_tfs</span> <span class="kw">&lt;-</span> <span class="no">summarized_viper_scores</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">tf</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">var</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span>(<span class="no">avg</span>))  <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="fl">180</span>, <span class="no">var</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="no">tf</span>)

<span class="co">## We prepare the data for the plot</span>
<span class="no">summarized_viper_scores_df</span> <span class="kw">&lt;-</span> <span class="no">summarized_viper_scores</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">semi_join</a></span>(<span class="no">highly_variable_tfs</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="st">"tf"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">std</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span>(<span class="no">tf</span>, <span class="no">avg</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">row.names</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">check.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">palette_length</span> <span class="kw">=</span> <span class="fl">100</span>
<span class="no">my_color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Darkblue"</span>, <span class="st">"white"</span>,<span class="st">"red"</span>))(<span class="no">palette_length</span>)

<span class="no">my_breaks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">summarized_viper_scores_df</span>), <span class="fl">0</span>,
                   <span class="kw">length.out</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span>(<span class="no">palette_length</span>/<span class="fl">2</span>) + <span class="fl">1</span>),
               <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">summarized_viper_scores_df</span>)/<span class="no">palette_length</span>,
                   <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">summarized_viper_scores_df</span>),
                   <span class="kw">length.out</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">palette_length</span>/<span class="fl">2</span>)))

<span class="no">viper_hmap</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html">pheatmap</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">summarized_viper_scores_df</span>),<span class="kw">fontsize</span><span class="kw">=</span><span class="fl">14</span>,
                       <span class="kw">fontsize_row</span> <span class="kw">=</span> <span class="fl">10</span>,
                       <span class="kw">color</span><span class="kw">=</span><span class="no">my_color</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">my_breaks</span>,
                       <span class="kw">main</span> <span class="kw">=</span> <span class="st">"DoRothEA (ABC)"</span>, <span class="kw">angle_col</span> <span class="kw">=</span> <span class="fl">45</span>,
                       <span class="kw">treeheight_col</span> <span class="kw">=</span> <span class="fl">0</span>,  <span class="kw">border_color</span> <span class="kw">=</span> <span class="fl">NA</span>)</pre></body></html></div>
<p><img src="single_cell_vignette_files/figure-html/tf%20heatmap-1.png" width="700"></p>
</div>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<pre><code>## R version 4.0.0 alpha (2020-04-05 r78150)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Mojave 10.14.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] viper_1.21.0        Biobase_2.47.3      BiocGenerics_0.33.3
##  [4] tidyr_1.0.2         pheatmap_1.0.12     tibble_3.0.0       
##  [7] Seurat_3.1.4        dplyr_0.8.5         dorothea_0.99.8    
## [10] BiocStyle_2.15.6   
## 
## loaded via a namespace (and not attached):
##   [1] TH.data_1.0-10      Rtsne_0.15          colorspace_1.4-1   
##   [4] class_7.3-16        ellipsis_0.3.0      ggridges_0.5.2     
##   [7] rprojroot_1.3-2     fs_1.4.1            rstudioapi_0.11    
##  [10] farver_2.0.3        leiden_0.3.3        listenv_0.8.0      
##  [13] npsurv_0.4-0        ggrepel_0.8.2       RSpectra_0.16-0    
##  [16] fansi_0.4.1         mvtnorm_1.1-0       codetools_0.2-16   
##  [19] splines_4.0.0       mnormt_1.5-6        lsei_1.2-0         
##  [22] knitr_1.28          TFisher_0.2.0       jsonlite_1.6.1     
##  [25] bcellViper_1.23.0   ica_1.0-2           kernlab_0.9-29     
##  [28] cluster_2.1.0       png_0.1-7           uwot_0.1.8         
##  [31] sctransform_0.2.1   BiocManager_1.30.10 compiler_4.0.0     
##  [34] httr_1.4.1          backports_1.1.6     lazyeval_0.2.2     
##  [37] assertthat_0.2.1    Matrix_1.2-18       cli_2.0.2          
##  [40] htmltools_0.4.0     tools_4.0.0         rsvd_1.0.3         
##  [43] igraph_1.2.5        gtable_0.3.0        glue_1.4.0         
##  [46] reshape2_1.4.3      RANN_2.6.1          Rcpp_1.0.4         
##  [49] pkgdown_1.5.1       vctrs_0.2.4         multtest_2.43.1    
##  [52] gdata_2.18.0        ape_5.3             nlme_3.1-145       
##  [55] gbRd_0.4-11         lmtest_0.9-37       xfun_0.12          
##  [58] stringr_1.4.0       globals_0.12.5      lifecycle_0.2.0    
##  [61] irlba_2.3.3         gtools_3.8.2        future_1.16.0      
##  [64] MASS_7.3-51.5       zoo_1.8-7           scales_1.1.0       
##  [67] sandwich_2.5-1      RColorBrewer_1.1-2  yaml_2.2.1         
##  [70] gridExtra_2.3       memoise_1.1.0       reticulate_1.15    
##  [73] pbapply_1.4-2       ggplot2_3.3.0       segmented_1.1-0    
##  [76] stringi_1.4.6       mutoss_0.1-12       desc_1.2.0         
##  [79] plotrix_3.7-7       e1071_1.7-3         caTools_1.18.0     
##  [82] bibtex_0.4.2.2      Rdpack_0.11-1       rlang_0.4.5        
##  [85] pkgconfig_2.0.3     bitops_1.0-6        evaluate_0.14      
##  [88] lattice_0.20-41     ROCR_1.0-7          purrr_0.3.3        
##  [91] labeling_0.3        patchwork_1.0.0     htmlwidgets_1.5.1  
##  [94] cowplot_1.0.0       tidyselect_1.0.0    RcppAnnoy_0.0.16   
##  [97] plyr_1.8.6          magrittr_1.5        bookdown_0.18      
## [100] R6_2.4.1            gplots_3.0.3        multcomp_1.4-12    
## [103] pillar_1.4.3        sn_1.6-1            mixtools_1.2.0     
## [106] fitdistrplus_1.0-14 survival_3.1-11     tsne_0.1-3         
## [109] future.apply_1.4.0  crayon_1.3.4        KernSmooth_2.23-16 
## [112] plotly_4.9.2.1      rmarkdown_2.1       grid_4.0.0         
## [115] data.table_1.12.8   metap_1.3           digest_0.6.25      
## [118] numDeriv_2016.8-1.1 stats4_4.0.0        munsell_0.5.0      
## [121] viridisLite_0.3.0</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Alvarez2016">
<p>Alvarez, Mariano J, Yao Shen, Federico M Giorgi, Alexander Lachmann, B Belinda Ding, B Hilda Ye, and Andrea Califano. 2016. “Functional Characterization of Somatic Mutations in Cancer Using Network-Based Inference of Protein Activity.” <em>Nature Genetics</em> 48 (8). Springer Science; Business Media LLC: 838–47. <a href="https://doi.org/10.1038/ng.3593">https://doi.org/10.1038/ng.3593</a>.</p>
</div>
<div id="ref-Dugourd2019">
<p>Dugourd, Aurelien, and Julio Saez-Rodriguez. 2019. “Footprint-Based Functional Analysis of Multiomic Data.” <em>Current Opinion in Systems Biology</em> 15 (June). Elsevier BV: 82–90. <a href="https://doi.org/10.1016/j.coisb.2019.04.002">https://doi.org/10.1016/j.coisb.2019.04.002</a>.</p>
</div>
<div id="ref-GarciaAlonso2019">
<p>Garcia-Alonso, Luz, Christian H. Holland, Mahmoud M. Ibrahim, Denes Turei, and Julio Saez-Rodriguez. 2019. “Benchmark and Integration of Resources for the Estimation of Human Transcription Factor Activities.” <em>Genome Research</em> 29 (8). Cold Spring Harbor Laboratory: 1363–75. <a href="https://doi.org/10.1101/gr.240663.118">https://doi.org/10.1101/gr.240663.118</a>.</p>
</div>
<div id="ref-Holland2020">
<p>Holland, Christian H., Jovan Tanevski, Javier Perales-Patón, Jan Gleixner, Manu P. Kumar, Elisabetta Mereu, Brian A. Joughin, et al. 2020. “Robustness and Applicability of Transcription Factor and Pathway Analysis Tools on Single-Cell RNA-Seq Data.” <em>Genome Biology</em> 21 (1). Springer Science; Business Media LLC. <a href="https://doi.org/10.1186/s13059-020-1949-z">https://doi.org/10.1186/s13059-020-1949-z</a>.</p>
</div>
<div id="ref-Stuart2019">
<p>Stuart, Tim, Andrew Butler, Paul Hoffman, Christoph Hafemeister, Efthymia Papalexi, William M. Mauck, Yuhan Hao, Marlon Stoeckius, Peter Smibert, and Rahul Satija. 2019. “Comprehensive Integration of Single-Cell Data.” <em>Cell</em> 177 (7). Elsevier BV: 1888–1902.e21. <a href="https://doi.org/10.1016/j.cell.2019.05.031">https://doi.org/10.1016/j.cell.2019.05.031</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christian H. Holland, Luz Garcia-Alonso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
